<!doctype html>
<html>
<head><meta charset="utf-8"><title>Login</title></head>
<body>
  <h2>Login</h2>
  <label>Email: <input id="email" type="email"></label><br/>
  <label>Password: <input id="password" type="password"></label><br/>
  <button id="login">Login</button>
  <div id="status"></div>

<script type="module">
import { SUPABASE_URL, SUPABASE_ANON_KEY } from "./config.js";
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


document.getElementById('login').addEventListener('click', async () => {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;

  const { data, error } = await supabase.auth.signInWithPassword({ email, password });

  if (error) {
    document.getElementById('status').innerText = 'Login error: ' + error.message;
    return;
  }

  // data.session.access_token est le token JWT
  const token = data.session?.access_token;
  if (!token) {
    document.getElementById('status').innerText = 'Connexion réussie, mais pas de token';
    return;
  }

  // On peut stocker la session en localStorage ou garder supabase client qui gère ça automatiquement.
  localStorage.setItem('sb_access_token', token);
  document.getElementById('status').innerText = 'Connecté. Tu peux aller sur la page GPS.';
});
</script>
</body>
</html>
