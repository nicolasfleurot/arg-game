<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test GPS → Supabase</title>
</head>
<body>
  <h2>Test GPS</h2>
  <div id="status">En attente de GPS…</div>

<script>
const USER_ID = "u-test123";
const API_URL = "/api/position"; // si HTML sur Vercel même domaine

function sendPosition(lat, lon) {
  fetch(API_URL, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ user_id: USER_ID, lat, lon })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("status").innerText = `Position envoyée : ${lat}, ${lon} → ${JSON.stringify(data)}`;
    console.log("Réponse API :", data);
  })
  .catch(err => {
    document.getElementById("status").innerText = "Erreur fetch : " + err;
    console.error(err);
  });
}

if ("geolocation" in navigator) {
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      console.log("GPS récupéré :", lat, lon);
      sendPosition(lat, lon);
    },
    (err) => {
      document.getElementById("status").innerText = "Erreur GPS : " + err.message;
      console.error(err);
    }
  );
} else {
  document.getElementById("status").innerText = "La géolocalisation n'est pas supportée.";
}
</script>
</body>
</html>
